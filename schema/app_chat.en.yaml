openapi: 3.0.0
info:
  title: Dify API - Chat Application
  description: |
    Dify API provides a series of interfaces for conversation functionality.
    It supports conversational applications.
    All API requests require an application-level API-Key in the Authorization HTTP Header.
    official raw document: https://github.com/langgenius/dify/blob/1.4.0/web/app/components/develop/template/template_chat.en.mdx
  version: 1.4.0
servers:
  - url: 'https://api.dify.ai/v1'
    description: Dify API Server
  - url: '{api_url}'
    variables:
      api_url:
        default: 'https://api.dify.ai/v1'
        description: Custom API server URL
  - url: 'http://ai.urchinet.lan/v1'
    description: author of dify-openapi dev server
security:
  - bearerApiKeyAuth: []
components:
  securitySchemes:
    bearerApiKeyAuth:
      type: http
      scheme: bearer
  responses:
    Error400:
      description: Request error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Error401:
      description: Non authorized or authentication failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Error404:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Error500:
      description: Server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
  schemas:
    Error:
      type: object
      properties:
        code:
          type: string
          description: Error code
        status:
          type: integer
          description: HTTP status code
        message:
          type: string
          description: Error message description
      required:
        - code
        - status
        - message
    Usage:
      type: object
      properties:
        prompt_tokens:
          type: integer
          description: Number of tokens used for prompts
        completion_tokens:
          type: integer
          description: Number of tokens used for completion
        total_tokens:
          type: integer
          description: Total number of tokens used
        prompt_unit_price:
          type: string
          description: Unit price for prompts
        prompt_price_unit:
          type: string
          description: Price unit for prompts
        prompt_price:
          type: string
          description: Total price for prompts
        completion_unit_price:
          type: string
          description: Unit price for completion
        completion_price_unit:
          type: string
          description: Price unit for completion
        completion_price:
          type: string
          description: Total price for completion
        total_price:
          type: string
          description: Total price
        currency:
          type: string
          description: Currency unit
        latency:
          type: number
          description: Latency time
    RetrieverResource:
      type: object
      properties:
        position:
          type: integer
          description: Position
        dataset_id:
          type: string
          description: Dataset ID
        dataset_name:
          type: string
          description: Dataset name
        document_id:
          type: string
          description: Document ID
        document_name:
          type: string
          description: Document name
        segment_id:
          type: string
          description: Segment ID
        score:
          type: number
          description: Relevance score
        content:
          type: string
          description: Content
    ChatCompletionResponse:
      type: object
      properties:
        message_id:
          type: string
          description: Unique message ID
        created_at:
          type: integer
          description: Message creation timestamp
        metadata:
          type: object
          properties:
            usage:
              $ref: '#/components/schemas/Usage'
            retriever_resources:
              type: array
              items:
                $ref: '#/components/schemas/RetrieverResource'
        conversation_id:
          type: string
          description: Conversation ID
        mode:
          type: string
          description: 'App mode, fixed as chat'
        answer:
          type: string
          description: Complete response content
    Conversation:
      type: object
      properties:
        id:
          type: string
          description: Conversation ID
        name:
          type: string
          description: Conversation name
        inputs:
          type: object
          description: User input parameters
        status:
          type: string
          description: Conversation status
        introduction:
          type: string
          description: Opening statement
        created_at:
          type: integer
          description: Creation time
        updated_at:
          type: integer
          description: Update time
    FileInput:
      type: object
      properties:
        type:
          type: string
          enum:
            - document
            - image
            - audio
            - video
            - custom
          description: File type
        transfer_method:
          type: string
          enum:
            - remote_url
            - local_file
          description: Transfer method
        url:
          type: string
          description: Remote URL
        upload_file_id:
          type: string
          description: Upload file ID
    ChatHistoryMessage:
      type: object
      properties:
        id:
          type: string
          description: Message ID
        conversation_id:
          type: string
          description: Conversation ID
        inputs:
          type: object
          description: User input parameters
        query:
          type: string
          description: User input/question content
        message_files:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                description: ID
              type:
                type: string
                description: 'File type, image'
              url:
                type: string
                description: Preview image URL
              belongs_to:
                type: string
                description: 'File ownership, user or assistant'
          description: Message files
        agent_thoughts:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                description: 'agent_thought ID, each Agent iteration round has a unique ID'
              message_id:
                type: string
                description: Unique message ID
              position:
                type: integer
                description: 'Position of agent_thought in the message, e.g., the first iteration has position 1'
              thought:
                type: string
                description: Agent's thinking content
              observation:
                type: string
                description: Return result of tool call
              tool:
                type: string
                description: 'List of tools used, multiple tools separated by ;'
              tool_input:
                type: string
                description: 'Tool input, JSON format string (object). E.g.: {"dalle3": {"prompt": "a cute cat"}}'
              created_at:
                type: integer
                description: 'Creation timestamp, e.g., 1705395332'
              message_files:
                type: array
                items:
                  type: string
                description: File IDs associated with the current agent_thought
              conversation_id:
                type: string
                description: Conversation ID
          description: Agent thinking content (only non-empty in Agent mode)
        answer:
          type: string
          description: Response message content
        created_at:
          type: integer
          description: Creation time
        feedback:
          type: object
          properties:
            rating:
              type: string
              enum:
                - like
                - dislike
              description: Like or dislike rating
          description: Feedback information
        retriever_resources:
          type: array
          items:
            $ref: '#/components/schemas/RetrieverResource'
          description: Citation and attribution segment list
    ChunkChatCompletionResponse:
      type: object
      properties:
        event:
          type: string
          enum:
            - message
            - message_end
            - tts_message
            - tts_message_end
            - message_replace
            - error
            - ping
            - agent_message
            - agent_thought
            - message_file
          description: 'Event type, determines the structure of the response'
        task_id:
          type: string
          description: 'Task ID for request tracking and stopping responses (used in message, message_end, tts_message, tts_message_end, message_replace, error, workflow events)'
        message_id:
          type: string
          description: 'Unique message ID (used in message, message_end, tts_message, tts_message_end, message_replace, error events)'
        conversation_id:
          type: string
          description: 'Conversation ID (used in message, message_end, message_replace, message_file, agent_message, agent_thought events)'
        workflow_run_id:
          type: string
          description: 'Workflow execution ID (used in workflow_started, node_started, node_finished, workflow_finished events)'
        answer:
          type: string
          description: 'Response content (used in message, message_replace, agent_message events)'
        audio:
          type: string
          description: 'Voice synthesis audio data (base64 encoded) (used in tts_message, tts_message_end events)'
        data:
          type: object
          description: 'Event related data (used in workflow_started, node_started, node_finished, workflow_finished events)'
        metadata:
          type: object
          description: Metadata including usage information and retriever resources (used in message_end event)
          properties:
            usage:
              $ref: '#/components/schemas/Usage'
            retriever_resources:
              type: array
              items:
                $ref: '#/components/schemas/RetrieverResource'
        created_at:
          type: integer
          description: 'Creation timestamp (used in message, tts_message, tts_message_end, message_replace, agent_message, agent_thought events)'
        id:
          type: string
          description: 'Unique ID (used in agent_thought, message_file events)'
        position:
          type: integer
          description: 'Position of agent_thought in the message, e.g., the first iteration has position 1 (used in agent_thought event)'
        thought:
          type: string
          description: Agent's thinking content (used in agent_thought event)
        observation:
          type: string
          description: Return result of tool call (used in agent_thought event)
        tool:
          type: string
          description: 'List of tools used, multiple tools separated by ; (used in agent_thought event)'
        tool_input:
          type: string
          description: 'Tool input, JSON format string (used in agent_thought event)'
        message_files:
          type: array
          items:
            type: string
          description: File IDs associated with the current agent_thought (used in agent_thought event)
        type:
          type: string
          description: 'File type, currently only ''image'' (used in message_file event)'
        belongs_to:
          type: string
          description: 'File ownership, user or assistant (used in message_file event)'
        url:
          type: string
          description: File access URL (used in message_file event)
    UploadedFile:
      type: object
      properties:
        id:
          type: string
          description: File ID
        name:
          type: string
          description: File name
        size:
          type: integer
          description: File size (bytes)
        extension:
          type: string
          description: File extension
        mime_type:
          type: string
          description: File mime-type
        created_by:
          type: string
          description: Uploader ID
        created_at:
          type: integer
          description: Upload time
paths:
  /chat-messages:
    post:
      operationId: sendChatMessageByAppChat
      summary: Send Chat Message (Conversational App)
      description: Create conversation message
      x-fern-streaming:
        format: sse
        # FIXME: @l8ng fern 暂时不支持
        # stream-condition: $request.response_mode == "streaming"
        response:
          $ref: '#/components/schemas/ChatCompletionResponse'
        response-stream:
          $ref: '#/components/schemas/ChunkChatCompletionResponse'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                  description: User input/question content
                inputs:
                  type: object
                  description: 'Allows passing values for variables defined by the App. The inputs parameter contains multiple key/value pairs, where each key corresponds to a specific variable and each value is the value for that variable. Default {}'
                response_mode:
                  type: string
                  enum:
                    - streaming
                    - blocking
                  description: |
                    Response mode:
                    - streaming: Streaming mode (recommended), implements typewriter-like output based on SSE
                    - blocking: Blocking mode, returns result after execution is complete (request may be interrupted if the process is too long)
                    Note: Blocking mode is not allowed in Agent mode
                user:
                  type: string
                  description: 'User identifier for defining end user identity, facilitating retrieval and statistics. Defined by developer rules, must be unique within the application.'
                conversation_id:
                  type: string
                  description: '(Optional) Conversation ID. Required when continuing a conversation based on previous chat history, must pass the conversation_id from previous messages'
                files:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                        enum:
                          - image
                        description: 'Supported type: image (currently only supports image formats)'
                      transfer_method:
                        type: string
                        enum:
                          - remote_url
                          - local_file
                        description: Transfer method
                      url:
                        type: string
                        description: Image URL (only when transfer_method is remote_url)
                      upload_file_id:
                        type: string
                        description: Upload file ID (only when transfer_method is local_file)
                  description: Uploaded files
                auto_generate_name:
                  type: boolean
                  description: '(Optional) Whether to automatically generate title, default is true. If set to false, you can call the conversation rename interface and set auto_generate to true to generate a title asynchronously.'
                  default: true
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatCompletionResponse'
                description: 'When response_mode is blocking, returns a ChatCompletionResponse object'
            text/event-stream:
              schema:
                $ref: '#/components/schemas/ChunkChatCompletionResponse'
                format: sse
                description: |
                  When response_mode is streaming, returns a ChunkChatCompletionResponse object stream sequence.
                  Returns App output stream chunks, Content-Type is text/event-stream.
                  Each stream chunk starts with data: and chunks are separated by \n\n (two newlines), as shown below:

                  data: {"event": "message", "task_id": "900bbd43-dc0b-4383-a372-aa6e6c414227", "id": "663c5084-a254-4040-8ad3-51f2a3c1a77c", "answer": "Hi", "created_at": 1705398420}\n\n

                  Stream chunks have different structures based on the event type:

                  - event: message LLM text chunk event, i.e., complete text output in chunks.
                    - task_id (string) Task ID for request tracking and stopping responses
                    - message_id (string) Unique message ID
                    - conversation_id (string) Conversation ID
                    - answer (string) LLM text chunk content
                    - created_at (int) Creation timestamp, e.g., 1705395332
                  - event: agent_message Agent mode text chunk event, i.e., text output in chunks in Agent mode (only used in Agent mode)
                    - task_id (string) Task ID for request tracking and stopping responses
                    - message_id (string) Unique message ID
                    - conversation_id (string) Conversation ID
                    - answer (string) LLM text chunk content
                    - created_at (int) Creation timestamp, e.g., 1705395332
                  - event: agent_thought Agent mode thinking step content related to tool calls (only used in Agent mode)
                    - id (string) agent_thought ID, each Agent iteration round has a unique ID
                    - task_id (string) Task ID for request tracking and stopping responses
                    - message_id (string) Unique message ID
                    - position (int) Position of agent_thought in the message, e.g., the first iteration has position 1
                    - thought (string) Agent's thinking content
                    - observation (string) Return result of tool call
                    - tool (string) List of tools used, multiple tools separated by ;
                    - tool_input (string) Tool input, JSON format string (object). E.g.: {"dalle3": {"prompt": "a cute cat"}}
                    - created_at (int) Creation timestamp, e.g., 1705395332
                    - message_files (array[string]) File IDs associated with the current agent_thought
                      - file_id (string) File ID
                    - conversation_id (string) Conversation ID
                  - event: message_file File event, indicates a new file to display
                    - id (string) Unique file ID
                    - type (string) File type, currently only image
                    - belongs_to (string) File ownership, user or assistant, this interface only returns assistant
                    - url (string) File access URL
                    - conversation_id (string) Conversation ID
                  - event: message_end Message end event, receiving this event means the stream response has ended.
                    - task_id (string) Task ID for request tracking and stopping responses
                    - message_id (string) Unique message ID
                    - conversation_id (string) Conversation ID
                    - metadata (object) Metadata
                      - usage (Usage) Model usage information
                      - retriever_resources (array[RetrieverResource]) Citation and attribution segment list
                  - event: tts_message TTS audio stream event, i.e., speech synthesis output. Content is an Mp3 format audio chunk encoded as a base64 string, decode directly for playback. (Only present when auto-play is enabled)
                    - task_id (string) Task ID for request tracking and stopping responses
                    - message_id (string) Unique message ID
                    - audio (string) Speech synthesis audio chunk encoded in Base64, decode directly for playback
                    - created_at (int) Creation timestamp, e.g., 1705395332
                  - event: tts_message_end TTS audio stream end event, receiving this event means the audio stream has ended.
                    - task_id (string) Task ID for request tracking and stopping responses
                    - message_id (string) Unique message ID
                    - audio (string) End event has no audio, so this is an empty string
                    - created_at (int) Creation timestamp, e.g., 1705395332
                  - event: message_replace Message content replacement event. When content review is enabled and output content is reviewed, if review conditions are met, this event replaces the message content with a preset reply.
                    - task_id (string) Task ID for request tracking and stopping responses
                    - message_id (string) Unique message ID
                    - conversation_id (string) Conversation ID
                    - answer (string) Replacement content (directly replaces all LLM reply text)
                    - created_at (int) Creation timestamp, e.g., 1705395332
                  - event: workflow_started workflow execution started
                    - task_id (string) Task ID for request tracking and stopping responses
                    - workflow_run_id (string) workflow execution ID
                    - event (string) Fixed as workflow_started
                    - data (object) Detailed content
                      - id (string) workflow execution ID
                      - workflow_id (string) Associated Workflow ID
                      - sequence_number (int) Auto-increment sequence number, starts from 1 within the App
                      - created_at (timestamp) Start time
                  - event: node_started node execution started
                    - task_id (string) Task ID for request tracking and stopping responses
                    - workflow_run_id (string) workflow execution ID
                    - event (string) Fixed as node_started
                    - data (object) Detailed content
                      - id (string) workflow execution ID
                      - node_id (string) Node ID
                      - node_type (string) Node type
                      - title (string) Node name
                      - index (int) Execution sequence number, used to display Tracing Node order
                      - predecessor_node_id (string) Predecessor node ID, used to display execution path in canvas
                      - inputs (object) All predecessor node variable content used in the node
                      - created_at (timestamp) Start time
                  - event: node_finished node execution ended, success/failure in the same event with different status
                    - task_id (string) Task ID for request tracking and stopping responses
                    - workflow_run_id (string) workflow execution ID
                    - event (string) Fixed as node_finished
                    - data (object) Detailed content
                      - id (string) node execution ID
                      - node_id (string) Node ID
                      - index (int) Execution sequence number, used to display Tracing Node order
                      - predecessor_node_id (string) optional Predecessor node ID, used to display execution path in canvas
                      - inputs (object) All predecessor node variable content used in the node
                      - process_data (json) Optional Node process data
                      - outputs (json) Optional Output content
                      - status (string) Execution status running / succeeded / failed / stopped
                      - error (string) Optional Error reason
                      - elapsed_time (float) Optional Time elapsed(s)
                      - execution_metadata (json) Metadata
                        - total_tokens (int) optional Total tokens used
                        - total_price (decimal) optional Total cost
                        - currency (string) optional Currency, such as USD / RMB
                      - created_at (timestamp) Start time
                  - event: workflow_finished workflow execution ended, success/failure in the same event with different status
                    - task_id (string) Task ID for request tracking and stopping responses
                    - workflow_run_id (string) workflow execution ID
                    - event (string) Fixed as workflow_finished
                    - data (object) Detailed content
                      - id (string) workflow execution ID
                      - workflow_id (string) Associated Workflow ID
                      - status (string) Execution status running / succeeded / failed / stopped
                      - outputs (json) Optional Output content
                      - error (string) Optional Error reason
                      - elapsed_time (float) Optional Time elapsed(s)
                      - total_tokens (int) Optional Total tokens used
                      - total_steps (int) Total steps (redundant), default 0
                      - created_at (timestamp) Start time
                      - finished_at (timestamp) End time
                  - event: error Exceptions during stream output are output as stream events, the stream ends after receiving an exception event.
                    - task_id (string) Task ID for request tracking and stopping responses
                    - message_id (string) Unique message ID
                    - status (int) HTTP status code
                    - code (string) Error code
                    - message (string) Error message
                  - event: ping Ping event every 10s to keep the connection alive.
        '400':
          $ref: '#/components/responses/Error400'
        '404':
          $ref: '#/components/responses/Error404'
        '500':
          $ref: '#/components/responses/Error500'
  /conversations:
    get:
      operationId: getConversationListByAppChat
      summary: Get Conversation List
      description: Get conversation list for current user
      parameters:
        - name: user
          in: query
          required: true
          schema:
            type: string
          description: User identifier
        - name: last_id
          in: query
          schema:
            type: string
          description: ID of the last record on current page
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: Records per page
        - name: sort_by
          in: query
          schema:
            type: string
            enum:
              - created_at
              - '-created_at'
              - updated_at
              - '-updated_at'
            default: '-updated_at'
          description: Sort field
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Conversation'
                  has_more:
                    type: boolean
                  limit:
                    type: integer
  '/conversations/{conversation_id}':
    delete:
      operationId: deleteConversationByAppChat
      summary: Delete Conversation
      parameters:
        - name: conversation_id
          in: path
          required: true
          schema:
            type: string
          description: Conversation ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: string
                  description: User identifier
      responses:
        '204':
          description: 'Successful response, no content'
  '/conversations/{conversation_id}/name':
    post:
      operationId: renameConversationByAppChat
      summary: Rename Conversation
      parameters:
        - name: conversation_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                name:
                  type: string
                  description: New name
                auto_generate:
                  type: boolean
                  default: false
                  description: Whether to automatically generate
                user:
                  type: string
                  description: User identifier
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Conversation'
  '/conversations/{conversation_id}/variables':
    get:
      operationId: getConversationVariablesByAppChat
      summary: Get Conversation Variables
      description: Retrieve variables from a specific conversation. This endpoint is useful for extracting structured data captured during conversations.
      parameters:
        - name: conversation_id
          in: path
          description: ID of the conversation to retrieve variables from
          required: true
          schema:
            type: string
        - name: user
          in: query
          description: 'User identifier, defined by developer rules, must be unique within the application'
          required: true
          schema:
            type: string
        - name: last_id
          in: query
          description: '(Optional) ID of the last record on the current page, default null'
          schema:
            type: string
        - name: limit
          in: query
          description: '(Optional) Number of records to return per request, default 20, max 100, min 1'
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Successfully retrieved variables
          content:
            application/json:
              schema:
                type: object
                properties:
                  limit:
                    type: integer
                    description: Items per page
                  has_more:
                    type: boolean
                    description: Whether there are more items
                  data:
                    type: array
                    description: List of variables
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: Variable ID
                        name:
                          type: string
                          description: Variable name
                        value_type:
                          type: string
                          description: 'Variable type (string, number, boolean, etc.)'
                        value:
                          type: string
                          description: Variable value
                        description:
                          type: string
                          description: Variable description
                        created_at:
                          type: integer
                          description: Creation timestamp
                        updated_at:
                          type: integer
                          description: Last update timestamp
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: string
                    enum:
                      - conversation_not_exists
                    description: Error code
                  message:
                    type: string
                    description: Error message
  /messages:
    get:
      operationId: getConversationMessagesByAppChat
      summary: Get Conversation History Messages
      parameters:
        - name: conversation_id
          in: query
          required: true
          schema:
            type: string
          description: Conversation ID
        - name: user
          in: query
          required: true
          schema:
            type: string
          description: User identifier
        - name: first_id
          in: query
          schema:
            type: string
          description: First message ID
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: Limit
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ChatHistoryMessage'
                  has_more:
                    type: boolean
                  limit:
                    type: integer
  '/messages/{message_id}/feedbacks':
    post:
      operationId: sendMessageFeedbackByAppChat
      summary: Message Feedback
      parameters:
        - name: message_id
          in: path
          required: true
          schema:
            type: string
          description: Message ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - rating
                - user
              properties:
                rating:
                  type: string
                  enum:
                    - like
                    - dislike
                    - null
                  description: Feedback type
                user:
                  type: string
                  description: User identifier
                content:
                  type: string
                  description: Feedback content
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: string
                    enum:
                      - success
  /app/feedbacks:
    get:
      operationId: getAppFeedbacksByAppChat
      summary: Get App Feedbacks
      description: Get application's user feedbacks and likes
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
          description: '(Optional) Pagination, default: 1'
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
          description: '(Optional) Records per page, default: 20'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    description: Returns the app's likes and feedback list
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: Feedback ID
                        app_id:
                          type: string
                          description: Application ID
                        conversation_id:
                          type: string
                          description: Conversation ID
                        message_id:
                          type: string
                          description: Message ID
                        rating:
                          type: string
                          description: Rating type (like/dislike)
                        content:
                          type: string
                          description: Feedback content
                        from_source:
                          type: string
                          description: Source
                        from_end_user_id:
                          type: string
                          description: End user ID
                        from_account_id:
                          type: string
                          description: Account ID
                        created_at:
                          type: string
                          description: Creation time
                        updated_at:
                          type: string
                          description: Update time
  '/messages/{message_id}/suggested':
    get:
      operationId: getSuggestedQuestionsByAppChat
      summary: Get Suggested Questions
      description: Get suggested questions for the next round
      parameters:
        - name: message_id
          in: path
          description: Message ID
          required: true
          schema:
            type: string
        - name: user
          in: query
          description: 'User identifier, defined by the developer, must be unique within the application'
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successfully retrieved suggested questions
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: string
                    description: Fixed return value 'success'
                  data:
                    type: array
                    description: List of suggested questions
                    items:
                      type: string
  /files/upload:
    post:
      operationId: uploadFileByAppChat
      summary: Upload File
      description: |
        Upload files for use when sending messages.
        Supported file types depend on application type and configuration.
        Uploaded files are only available to the current end user.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: File to upload
                user:
                  type: string
                  description: User identifier
              required:
                - file
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadedFile'
        '400':
          $ref: '#/components/responses/Error400'
        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '415':
          description: Unsupported file type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: Storage service error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /info:
    get:
      operationId: getApplicationInfoByAppChat
      summary: Get Application Basic Information
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    description: Application name
                  description:
                    type: string
                    description: Application description
                  tags:
                    type: array
                    items:
                      type: string
                    description: Application tags
  '/chat-messages/{task_id}/stop':
    post:
      operationId: stopChatResponseByAppChat
      summary: Stop Response
      description: Only supports streaming mode
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
          description: 'Task ID, can be obtained from the streaming response chunks'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  type: string
                  description: 'User identifier, must be consistent with the user passed in the message sending interface'
      responses:
        '200':
          description: Successfully stopped the response
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: string
                    enum:
                      - success
                    description: Fixed return value 'success'
  /audio-to-text:
    post:
      operationId: convertAudioToTextByAppChat
      summary: Audio to Text
      description: Convert audio to text
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Audio file
                user:
                  type: string
                  description: User identifier
              required:
                - file
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  text:
                    type: string
                    description: Converted text
  /text-to-audio:
    post:
      operationId: convertTextToAudioByAppChat
      summary: Text to Audio
      description: Convert text to speech
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                message_id:
                  type: string
                  description: 'Dify generated text message ID. The backend will find the corresponding content directly through the message_id to synthesize speech. If both message_id and text are provided, message_id takes precedence'
                text:
                  type: string
                  description: 'Text content for speech generation. If message_id is not provided, this field will be used'
                user:
                  type: string
                  description: 'User identifier, defined by developer rules, must be unique within the application'
      responses:
        '200':
          description: Successful response
          content:
            audio/wav:
              schema:
                type: string
                format: binary
                description: Audio file
  /parameters:
    get:
      operationId: getApplicationParametersByAppChat
      summary: Get Application Parameters
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  opening_statement:
                    type: string
                    description: Opening statement
                  suggested_questions:
                    type: array
                    items:
                      type: string
                    description: List of suggested opening questions
                  suggested_questions_after_answer:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                    description: Settings for suggested questions after answer
                  speech_to_text:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                    description: Audio to text settings
                  retriever_resource:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                    description: Citation and attribution settings
                  annotation_reply:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                    description: Annotation reply settings
                  user_input_form:
                    type: array
                    items:
                      type: object
                    description: User input form configuration
                  file_upload:
                    type: object
                    description: File upload configuration
                  system_parameters:
                    type: object
                    properties:
                      file_size_limit:
                        type: integer
                        description: Document upload size limit (MB)
                      image_file_size_limit:
                        type: integer
                        description: Image file upload size limit (MB)
                      audio_file_size_limit:
                        type: integer
                        description: Audio file upload size limit (MB)
                      video_file_size_limit:
                        type: integer
                        description: Video file upload size limit (MB)
                    description: System parameters
  /meta:
    get:
      operationId: getAppMetaInfoByAppChat
      summary: Get App Meta Information
      description: Used to get tool icons
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  tool_icons:
                    type: object
                    description: Tool icons
                    additionalProperties:
                      oneOf:
                        - type: object
                          properties:
                            background:
                              type: string
                              description: Background color in hex format
                            content:
                              type: string
                              description: Emoji
                        - type: string
                          description: Icon URL
  /site:
    get:
      operationId: getAppSiteSettingsByAppChat
      summary: Get App WebApp Settings
      description: Used to get the WebApp settings of the application
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  title:
                    type: string
                    description: WebApp name
                  chat_color_theme:
                    type: string
                    description: 'Chat color theme, hex format'
                  chat_color_theme_inverted:
                    type: boolean
                    description: Whether the chat color theme is inverted
                  icon_type:
                    type: string
                    description: 'Icon type, emoji-emoji, image-image'
                  icon:
                    type: string
                    description: 'Icon, if type is emoji, it''s an emoji symbol, if type is image, it''s an image URL'
                  icon_background:
                    type: string
                    description: Background color in hex format
                  icon_url:
                    type: string
                    description: Icon URL
                  description:
                    type: string
                    description: Description
                  copyright:
                    type: string
                    description: Copyright information
                  privacy_policy:
                    type: string
                    description: Privacy policy link
                  custom_disclaimer:
                    type: string
                    description: Custom disclaimer
                  default_language:
                    type: string
                    description: Default language
                  show_workflow_steps:
                    type: boolean
                    description: Whether to show workflow details
                  use_icon_as_answer_icon:
                    type: boolean
                    description: "Whether to use the WebApp icon to replace the \U0001F916 in chat"
  /apps/annotations:
    get:
      operationId: getAnnotationsListByAppChat
      summary: Get Annotation List
      description: Get the list of annotations for the application
      parameters:
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Successfully retrieved annotation list
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: Annotation ID
                        question:
                          type: string
                          description: Question
                        answer:
                          type: string
                          description: Answer
                        hit_count:
                          type: integer
                          description: Hit count
                        created_at:
                          type: integer
                          description: Creation timestamp
                  has_more:
                    type: boolean
                    description: Whether there is more data
                  limit:
                    type: integer
                    description: Items per page
                  total:
                    type: integer
                    description: Total record count
                  page:
                    type: integer
                    description: Current page number
    post:
      operationId: createAnnotationByAppChat
      summary: Create Annotation
      description: Create a new annotation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - question
                - answer
              properties:
                question:
                  type: string
                  description: Question
                answer:
                  type: string
                  description: Answer
      responses:
        '200':
          description: Successfully created annotation
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Annotation ID
                  question:
                    type: string
                    description: Question
                  answer:
                    type: string
                    description: Answer
                  hit_count:
                    type: integer
                    description: Hit count
                  created_at:
                    type: integer
                    description: Creation timestamp
  '/apps/annotations/{annotation_id}':
    put:
      operationId: updateAnnotationByAppChat
      summary: Update Annotation
      description: Update a specific annotation
      parameters:
        - name: annotation_id
          in: path
          description: Annotation ID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - question
                - answer
              properties:
                question:
                  type: string
                  description: Question
                answer:
                  type: string
                  description: Answer
      responses:
        '200':
          description: Successfully updated annotation
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Annotation ID
                  question:
                    type: string
                    description: Question
                  answer:
                    type: string
                    description: Answer
                  hit_count:
                    type: integer
                    description: Hit count
                  created_at:
                    type: integer
                    description: Creation timestamp
    delete:
      operationId: deleteAnnotationByAppChat
      summary: Delete Annotation
      description: Delete a specific annotation
      parameters:
        - name: annotation_id
          in: path
          description: Annotation ID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successfully deleted annotation
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: string
                    enum:
                      - success
  '/apps/annotation-reply/{action}':
    post:
      operationId: configureAnnotationReplyByAppChat
      summary: Initialize Annotation Reply Settings
      description: Enable or disable annotation reply functionality
      parameters:
        - name: action
          in: path
          description: 'Action, can only be ''enable'' or ''disable'''
          required: true
          schema:
            type: string
            enum:
              - enable
              - disable
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                embedding_provider_name:
                  type: string
                  description: 'Specified embedding model provider, must be configured in the system first, corresponds to the provider field'
                embedding_model_name:
                  type: string
                  description: 'Specified embedding model, corresponds to the model field'
                score_threshold:
                  type: number
                  description: 'Similarity score threshold, when similarity is greater than this threshold, the system will automatically reply, otherwise it will not reply'
      responses:
        '200':
          description: Successfully enabled or disabled annotation reply
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                    description: Job ID
                  job_status:
                    type: string
                    description: Job status
  '/apps/annotation-reply/{action}/status/{job_id}':
    get:
      operationId: getAnnotationReplyStatusByAppChat
      summary: Check Annotation Reply Settings Status
      description: Query the status of annotation reply initialization task
      parameters:
        - name: action
          in: path
          description: 'Action, can only be ''enable'' or ''disable'', and must be consistent with the action in the annotation reply initialization interface'
          required: true
          schema:
            type: string
            enum:
              - enable
              - disable
        - name: job_id
          in: path
          description: 'Job ID, returned from the annotation reply initialization interface'
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successfully retrieved job status
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                    description: Job ID
                  job_status:
                    type: string
                    description: Job status
                  error_msg:
                    type: string
                    description: Error message

