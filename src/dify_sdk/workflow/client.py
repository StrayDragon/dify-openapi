# This file was auto-generated by Fern from our API Definition.

import typing

from .. import core
from ..core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ..core.request_options import RequestOptions
from .raw_client import AsyncRawWorkflowClient, RawWorkflowClient
from .types.chunk_workflow_message import ChunkWorkflowMessage
from .types.get_app_info_response import GetAppInfoResponse
from .types.get_app_parameters_response import GetAppParametersResponse
from .types.get_app_site_response import GetAppSiteResponse
from .types.get_workflow_execution_status_response import GetWorkflowExecutionStatusResponse
from .types.get_workflow_logs_request_status import GetWorkflowLogsRequestStatus
from .types.get_workflow_logs_response import GetWorkflowLogsResponse
from .types.run_workflow_request_response_mode import RunWorkflowRequestResponseMode
from .types.stop_workflow_response import StopWorkflowResponse
from .types.upload_file_response import UploadFileResponse

# this is used as the default value for optional parameters
OMIT = typing.cast(typing.Any, ...)


class WorkflowClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawWorkflowClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> RawWorkflowClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawWorkflowClient
        """
        return self._raw_client

    def run_workflow(
        self,
        *,
        inputs: typing.Dict[str, typing.Optional[typing.Any]],
        response_mode: RunWorkflowRequestResponseMode,
        user: str,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> typing.Iterator[ChunkWorkflowMessage]:
        """
        Execute a workflow. Cannot be executed if there is no published workflow.

        Parameters
        ----------
        inputs : typing.Dict[str, typing.Optional[typing.Any]]
            Allows passing values for variables defined in the App.
            The inputs parameter contains multiple key/value pairs, where each key corresponds to a specific variable and each value is the specific value for that variable. Variables can be of file list type.
            File list type variables are suitable for passing files combined with text understanding to answer questions, only available when the model supports parsing capabilities for that type of file. If the variable is a file list type, the value corresponding to the variable should be in list format, where each element should include the following:
              - `type` (string) Supported types:
                - `document` Specific types include: 'TXT', 'MD', 'MARKDOWN', 'PDF', 'HTML', 'XLSX', 'XLS', 'DOCX', 'CSV', 'EML', 'MSG', 'PPTX', 'PPT', 'XML', 'EPUB'
                - `image` Specific types include: 'JPG', 'JPEG', 'PNG', 'GIF', 'WEBP', 'SVG'
                - `audio` Specific types include: 'MP3', 'M4A', 'WAV', 'WEBM', 'AMR'
                - `video` Specific types include: 'MP4', 'MOV', 'MPEG', 'MPGA'
                - `custom` Specific types include: other file types
              - `transfer_method` (string) Transfer method, `remote_url` image address / `local_file` uploaded file
              - `url` (string) Image address (only when the transfer method is `remote_url`)
              - `upload_file_id` (string) Upload file ID (only when the transfer method is `local_file`)

        response_mode : RunWorkflowRequestResponseMode
            Response mode, supports:
            - `streaming` Streaming mode (recommended). Implements streaming return similar to typewriter output based on SSE (Server-Sent Events).
            - `blocking` Blocking mode, waits for execution to complete before returning results. (Requests may be interrupted if the process is lengthy).
            Due to Cloudflare limitations, requests will be interrupted after 100 seconds of timeout with no response.

        user : str
            User identifier, used to define the identity of the end user, for easy retrieval and statistics.
            Rules defined by the developer, the user identifier must be unique within the application.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Yields
        ------
        typing.Iterator[ChunkWorkflowMessage]
            Successful response

        Examples
        --------
        from dify import DifyApi
        client = DifyApi(token="YOUR_TOKEN", )
        response = client.workflow.run_workflow(inputs={'key': 'value'
        }, response_mode="streaming", user='user', )
        for chunk in response:
            yield chunk
        """
        with self._raw_client.run_workflow(
            inputs=inputs, response_mode=response_mode, user=user, request_options=request_options
        ) as r:
            yield from r.data

    def get_workflow_execution_status(
        self, workflow_run_id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> GetWorkflowExecutionStatusResponse:
        """
        Get the current execution result of a workflow task based on the workflow execution ID

        Parameters
        ----------
        workflow_run_id : str
            Workflow run ID, can be obtained from the streaming response chunks

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetWorkflowExecutionStatusResponse
            Successfully retrieved workflow execution status

        Examples
        --------
        from dify import DifyApi
        client = DifyApi(token="YOUR_TOKEN", )
        client.workflow.get_workflow_execution_status(workflow_run_id='workflow_run_id', )
        """
        _response = self._raw_client.get_workflow_execution_status(workflow_run_id, request_options=request_options)
        return _response.data

    def stop_workflow(
        self, task_id: str, *, user: str, request_options: typing.Optional[RequestOptions] = None
    ) -> StopWorkflowResponse:
        """
        Only supports streaming mode

        Parameters
        ----------
        task_id : str
            Task ID, can be obtained from the streaming response chunks

        user : str
            User identifier, must be consistent with the user passed in the message sending interface

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        StopWorkflowResponse
            Successfully stopped the response

        Examples
        --------
        from dify import DifyApi
        client = DifyApi(token="YOUR_TOKEN", )
        client.workflow.stop_workflow(task_id='task_id', user='user', )
        """
        _response = self._raw_client.stop_workflow(task_id, user=user, request_options=request_options)
        return _response.data

    def get_workflow_logs(
        self,
        *,
        keyword: typing.Optional[str] = None,
        status: typing.Optional[GetWorkflowLogsRequestStatus] = None,
        page: typing.Optional[int] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> GetWorkflowLogsResponse:
        """
        Return workflow logs in reverse order

        Parameters
        ----------
        keyword : typing.Optional[str]
            Keyword

        status : typing.Optional[GetWorkflowLogsRequestStatus]
            Execution status: succeeded/failed/stopped

        page : typing.Optional[int]
            Current page number, default 1

        limit : typing.Optional[int]
            Items per page, default 20

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetWorkflowLogsResponse
            Successfully retrieved workflow logs

        Examples
        --------
        from dify import DifyApi
        client = DifyApi(token="YOUR_TOKEN", )
        client.workflow.get_workflow_logs()
        """
        _response = self._raw_client.get_workflow_logs(
            keyword=keyword, status=status, page=page, limit=limit, request_options=request_options
        )
        return _response.data

    def upload_file(
        self, *, file: core.File, user: str, request_options: typing.Optional[RequestOptions] = None
    ) -> UploadFileResponse:
        """
        Upload a file to use when sending messages, enabling multimodal understanding. Supports any format supported by your workflow. Uploaded files are only available to the current end user.

        Parameters
        ----------
        file : core.File
            See core.File for more documentation

        user : str
            User identifier, used to define the identity of the end user, must be consistent with the user passed in the message sending interface

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        UploadFileResponse
            File uploaded successfully

        Examples
        --------
        from dify import DifyApi
        client = DifyApi(token="YOUR_TOKEN", )
        client.workflow.upload_file(user='user', )
        """
        _response = self._raw_client.upload_file(file=file, user=user, request_options=request_options)
        return _response.data

    def get_app_info(self, *, request_options: typing.Optional[RequestOptions] = None) -> GetAppInfoResponse:
        """
        Used to get basic information about the application

        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAppInfoResponse
            Successfully retrieved application information

        Examples
        --------
        from dify import DifyApi
        client = DifyApi(token="YOUR_TOKEN", )
        client.workflow.get_app_info()
        """
        _response = self._raw_client.get_app_info(request_options=request_options)
        return _response.data

    def get_app_parameters(
        self, *, request_options: typing.Optional[RequestOptions] = None
    ) -> GetAppParametersResponse:
        """
        Used at the beginning of page entry to get feature switches, input parameter names, types, and default values

        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAppParametersResponse
            Successfully retrieved application parameters

        Examples
        --------
        from dify import DifyApi
        client = DifyApi(token="YOUR_TOKEN", )
        client.workflow.get_app_parameters()
        """
        _response = self._raw_client.get_app_parameters(request_options=request_options)
        return _response.data

    def get_app_site(self, *, request_options: typing.Optional[RequestOptions] = None) -> GetAppSiteResponse:
        """
        Used to get the WebApp settings of the application

        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAppSiteResponse
            Successfully retrieved application WebApp settings

        Examples
        --------
        from dify import DifyApi
        client = DifyApi(token="YOUR_TOKEN", )
        client.workflow.get_app_site()
        """
        _response = self._raw_client.get_app_site(request_options=request_options)
        return _response.data


class AsyncWorkflowClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawWorkflowClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> AsyncRawWorkflowClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawWorkflowClient
        """
        return self._raw_client

    async def run_workflow(
        self,
        *,
        inputs: typing.Dict[str, typing.Optional[typing.Any]],
        response_mode: RunWorkflowRequestResponseMode,
        user: str,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> typing.AsyncIterator[ChunkWorkflowMessage]:
        """
        Execute a workflow. Cannot be executed if there is no published workflow.

        Parameters
        ----------
        inputs : typing.Dict[str, typing.Optional[typing.Any]]
            Allows passing values for variables defined in the App.
            The inputs parameter contains multiple key/value pairs, where each key corresponds to a specific variable and each value is the specific value for that variable. Variables can be of file list type.
            File list type variables are suitable for passing files combined with text understanding to answer questions, only available when the model supports parsing capabilities for that type of file. If the variable is a file list type, the value corresponding to the variable should be in list format, where each element should include the following:
              - `type` (string) Supported types:
                - `document` Specific types include: 'TXT', 'MD', 'MARKDOWN', 'PDF', 'HTML', 'XLSX', 'XLS', 'DOCX', 'CSV', 'EML', 'MSG', 'PPTX', 'PPT', 'XML', 'EPUB'
                - `image` Specific types include: 'JPG', 'JPEG', 'PNG', 'GIF', 'WEBP', 'SVG'
                - `audio` Specific types include: 'MP3', 'M4A', 'WAV', 'WEBM', 'AMR'
                - `video` Specific types include: 'MP4', 'MOV', 'MPEG', 'MPGA'
                - `custom` Specific types include: other file types
              - `transfer_method` (string) Transfer method, `remote_url` image address / `local_file` uploaded file
              - `url` (string) Image address (only when the transfer method is `remote_url`)
              - `upload_file_id` (string) Upload file ID (only when the transfer method is `local_file`)

        response_mode : RunWorkflowRequestResponseMode
            Response mode, supports:
            - `streaming` Streaming mode (recommended). Implements streaming return similar to typewriter output based on SSE (Server-Sent Events).
            - `blocking` Blocking mode, waits for execution to complete before returning results. (Requests may be interrupted if the process is lengthy).
            Due to Cloudflare limitations, requests will be interrupted after 100 seconds of timeout with no response.

        user : str
            User identifier, used to define the identity of the end user, for easy retrieval and statistics.
            Rules defined by the developer, the user identifier must be unique within the application.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Yields
        ------
        typing.AsyncIterator[ChunkWorkflowMessage]
            Successful response

        Examples
        --------
        from dify import AsyncDifyApi
        import asyncio
        client = AsyncDifyApi(token="YOUR_TOKEN", )
        async def main() -> None:
            response = await client.workflow.run_workflow(inputs={'key': 'value'
            }, response_mode="streaming", user='user', )
            async for chunk in response:
                yield chunk
        asyncio.run(main())
        """
        async with self._raw_client.run_workflow(
            inputs=inputs, response_mode=response_mode, user=user, request_options=request_options
        ) as r:
            async for data in r.data:
                yield data

    async def get_workflow_execution_status(
        self, workflow_run_id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> GetWorkflowExecutionStatusResponse:
        """
        Get the current execution result of a workflow task based on the workflow execution ID

        Parameters
        ----------
        workflow_run_id : str
            Workflow run ID, can be obtained from the streaming response chunks

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetWorkflowExecutionStatusResponse
            Successfully retrieved workflow execution status

        Examples
        --------
        from dify import AsyncDifyApi
        import asyncio
        client = AsyncDifyApi(token="YOUR_TOKEN", )
        async def main() -> None:
            await client.workflow.get_workflow_execution_status(workflow_run_id='workflow_run_id', )
        asyncio.run(main())
        """
        _response = await self._raw_client.get_workflow_execution_status(
            workflow_run_id, request_options=request_options
        )
        return _response.data

    async def stop_workflow(
        self, task_id: str, *, user: str, request_options: typing.Optional[RequestOptions] = None
    ) -> StopWorkflowResponse:
        """
        Only supports streaming mode

        Parameters
        ----------
        task_id : str
            Task ID, can be obtained from the streaming response chunks

        user : str
            User identifier, must be consistent with the user passed in the message sending interface

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        StopWorkflowResponse
            Successfully stopped the response

        Examples
        --------
        from dify import AsyncDifyApi
        import asyncio
        client = AsyncDifyApi(token="YOUR_TOKEN", )
        async def main() -> None:
            await client.workflow.stop_workflow(task_id='task_id', user='user', )
        asyncio.run(main())
        """
        _response = await self._raw_client.stop_workflow(task_id, user=user, request_options=request_options)
        return _response.data

    async def get_workflow_logs(
        self,
        *,
        keyword: typing.Optional[str] = None,
        status: typing.Optional[GetWorkflowLogsRequestStatus] = None,
        page: typing.Optional[int] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> GetWorkflowLogsResponse:
        """
        Return workflow logs in reverse order

        Parameters
        ----------
        keyword : typing.Optional[str]
            Keyword

        status : typing.Optional[GetWorkflowLogsRequestStatus]
            Execution status: succeeded/failed/stopped

        page : typing.Optional[int]
            Current page number, default 1

        limit : typing.Optional[int]
            Items per page, default 20

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetWorkflowLogsResponse
            Successfully retrieved workflow logs

        Examples
        --------
        from dify import AsyncDifyApi
        import asyncio
        client = AsyncDifyApi(token="YOUR_TOKEN", )
        async def main() -> None:
            await client.workflow.get_workflow_logs()
        asyncio.run(main())
        """
        _response = await self._raw_client.get_workflow_logs(
            keyword=keyword, status=status, page=page, limit=limit, request_options=request_options
        )
        return _response.data

    async def upload_file(
        self, *, file: core.File, user: str, request_options: typing.Optional[RequestOptions] = None
    ) -> UploadFileResponse:
        """
        Upload a file to use when sending messages, enabling multimodal understanding. Supports any format supported by your workflow. Uploaded files are only available to the current end user.

        Parameters
        ----------
        file : core.File
            See core.File for more documentation

        user : str
            User identifier, used to define the identity of the end user, must be consistent with the user passed in the message sending interface

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        UploadFileResponse
            File uploaded successfully

        Examples
        --------
        from dify import AsyncDifyApi
        import asyncio
        client = AsyncDifyApi(token="YOUR_TOKEN", )
        async def main() -> None:
            await client.workflow.upload_file(user='user', )
        asyncio.run(main())
        """
        _response = await self._raw_client.upload_file(file=file, user=user, request_options=request_options)
        return _response.data

    async def get_app_info(self, *, request_options: typing.Optional[RequestOptions] = None) -> GetAppInfoResponse:
        """
        Used to get basic information about the application

        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAppInfoResponse
            Successfully retrieved application information

        Examples
        --------
        from dify import AsyncDifyApi
        import asyncio
        client = AsyncDifyApi(token="YOUR_TOKEN", )
        async def main() -> None:
            await client.workflow.get_app_info()
        asyncio.run(main())
        """
        _response = await self._raw_client.get_app_info(request_options=request_options)
        return _response.data

    async def get_app_parameters(
        self, *, request_options: typing.Optional[RequestOptions] = None
    ) -> GetAppParametersResponse:
        """
        Used at the beginning of page entry to get feature switches, input parameter names, types, and default values

        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAppParametersResponse
            Successfully retrieved application parameters

        Examples
        --------
        from dify import AsyncDifyApi
        import asyncio
        client = AsyncDifyApi(token="YOUR_TOKEN", )
        async def main() -> None:
            await client.workflow.get_app_parameters()
        asyncio.run(main())
        """
        _response = await self._raw_client.get_app_parameters(request_options=request_options)
        return _response.data

    async def get_app_site(self, *, request_options: typing.Optional[RequestOptions] = None) -> GetAppSiteResponse:
        """
        Used to get the WebApp settings of the application

        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        GetAppSiteResponse
            Successfully retrieved application WebApp settings

        Examples
        --------
        from dify import AsyncDifyApi
        import asyncio
        client = AsyncDifyApi(token="YOUR_TOKEN", )
        async def main() -> None:
            await client.workflow.get_app_site()
        asyncio.run(main())
        """
        _response = await self._raw_client.get_app_site(request_options=request_options)
        return _response.data
